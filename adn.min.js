(function(){this.ADN={}}).call(this),function(){"use strict";function e(e,t){this.message=e,this.status=t}function t(t,n,r){var i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),t.credentials&&(i.withCredentials=!0),Object.keys(t.headers||{}).forEach(function(e){i.setRequestHeader(e,t.headers[e])}),i.onload=function(t){[200,304,0].indexOf(i.status)===-1?r(new e("Server responded with a status of "+i.status,i.status)):n(t.target)},i.send(t.data||void 0)}e.prototype=new Error,e.prototype.constructor=e,Object.defineProperty(ADN,"xhr",{value:t}),Object.defineProperty(ADN,"XhrError",{value:e})}(),function(){"use strict";function t(e,t){this.clientID=e,this.redirectURI=t}var e="https://alpha.app.net/oauth/authorize";t.prototype={authenticate:function(){window.location=this.getUri()},clearToken:function(){localStorage.removeItem("accessToken")},getUri:function(){return e+"?client_id="+this.clientID+"&response_type=token"+"&redirect_uri="+this.redirectURI+"&scope=write_post,follow,messages,stream"},hasAccessToken:function(){return typeof localStorage.accessToken!="undefined"&&localStorage.accessToken!==null},hasRedirected:function(){var e=window.location.hash.substr(1).split("access_token=")[1];return e?(localStorage.accessToken=e,window.location=this.redirectURI,!0):!1},isAuthenticated:function(){return this.hasAccessToken()||this.hasRedirected()}},Object.defineProperty(ADN,"Authenticator",{value:t})}(),function(){"use strict";function t(){var e=Array.prototype.slice.call(arguments),t="",n=e[0];return e.splice(0,1),t=n,e.forEach(function(e,n){var r=e.toString();t=t.replace("{"+n+"}",r)}),t}function n(e){this.format=e,this.urlParameters=[],this.queryParameters=[]}var e="https://alpha-api.app.net/stream/0/";n.prototype={addQueryParameter:function(e,t){this.queryParameters.push([e,t])},addUrlParameter:function(e){this.urlParameters.push(e)},buildUrl:function(){var n=e+this.format;if(this.urlParameters.length>0){var r=this.urlParameters.slice(0);r.unshift(n),n=t.apply(null,r)}return this.queryParameters.length===0?n:(this.queryParameters.forEach(function(e,t){var r=t===0?"?":"&";n+=r+e[0]+"="+e[1]}),n)},reset:function(){this.queryParameters=[],this.urlParameters=[]}},Object.defineProperty(ADN,"Endpoint",{value:n})}(),function(){"use strict";function e(){}e.prototype={sendRequest:function(e,t,n){e=e||{},e.url=(e.endpoint||this.endpoint).buildUrl(),e.headers=e.headers||{},e.headers.Authorization="Bearer "+localStorage.accessToken,e.headers.Accept="application/json",this.endpoint.reset(),ADN.xhr(e,function(e){if(e&&e.responseText){var n=JSON.parse(e.responseText);t(n)}else t()},function(t){if(t instanceof ADN.XhrError&&t.status===401){var r=new ADN.Authenticator;r.clearToken(),r.authenticate()}(n||function(){})(t)})}},Object.defineProperty(ADN,"Access",{value:e})}(),function(){"use strict";function e(){ADN.Access.apply(this,arguments)}e.prototype=Object.create(ADN.Access.prototype),e.prototype.setOldestPostId=function(e){e&&e.length>0&&(this.oldestPostId=e[e.length-1].id)},e.prototype.setNewestPostId=function(e){e&&e.length>0&&(this.newestPostId=e[0].id)},e.prototype.fetchNew=function(e,t){if(this.newestPostId)this.endpoint.addQueryParameter("min_id",this.newestPostId);else var n=!0;var r=this;this.retrieve(function(t){t.sort(function(e,t){return e.id<t.id?1:-1}),r.setNewestPostId(t),n&&r.setOldestPostId(t),e(t)},t)},e.prototype.fetchMore=function(e,t){if(!this.oldestPostId)return;var n=this;this.endpoint.addQueryParameter("max_id",this.oldestPostId),this.retrieve(function(t){t.sort(function(e,t){return e.id<t.id?1:-1}),n.setOldestPostId(t),e(t)},t)},e.prototype.retrieve=function(e,t){var n=this;this.sendRequest(null,function(t){e.call(n,t)},t)},Object.defineProperty(ADN,"Stream",{value:e})}(),function(){"use strict";function e(){ADN.Stream.apply(this,arguments),this.endpoint=new ADN.Endpoint("posts/stream")}e.prototype=Object.create(ADN.Stream.prototype),Object.defineProperty(ADN,"Feed",{value:e})}(),function(){"use strict";function e(){ADN.Stream.apply(this,arguments),this.endpoint=new ADN.Endpoint("users/me/mentions")}e.prototype=Object.create(ADN.Stream.prototype),Object.defineProperty(ADN,"Mentions",{value:e})}(),function(){"use strict";function e(){ADN.Stream.apply(this,arguments),this.endpoint=new ADN.Endpoint("posts/stream/global")}e.prototype=Object.create(ADN.Stream.prototype),Object.defineProperty(ADN,"Global",{value:e})}(),function(){"use strict";function e(e){ADN.Stream.apply(this,arguments),this.endpoint=new ADN.Endpoint("users/"+e+"/posts")}e.prototype=Object.create(ADN.Stream.prototype),Object.defineProperty(ADN,"UserStream",{value:e})}(),function(){"use strict";function t(){this.endpoint=new ADN.Endpoint("users/{0}"),this.followEndpoint=new ADN.Endpoint("users/{0}/follow"),this.muteEndpoint=new ADN.Endpoint("users/{0}/mute")}var e="https://alpha-api.app.net/stream/0/users/";t.prototype=Object.create(ADN.Access.prototype),t.prototype.retrieve=function(e,t,n){this.endpoint.addUrlParameter(e),this.sendRequest(null,t,n)},t.prototype.endpointCall=function(e,t,n,r,i){t.addUrlParameter(e);var s={endpoint:t,method:n,credentials:!0};this.sendRequest(s,r,i)},t.prototype.follow=function(e,t,n){this.endpointCall(e,this.followEndpoint,"POST",t,n)},t.prototype.unfollow=function(e,t,n){this.endpointCall(e,this.followEndpoint,"DELETE",t,n)},t.prototype.mute=function(e,t,n){this.endpointCall(e,this.muteEndpoint,"POST",t,n)},t.prototype.unmute=function(e,t,n){this.endpointCall(e,this.muteEndpoint,"DELETE",t,n)},Object.defineProperty(ADN,"User",{value:t})}(),function(){"use strict";function e(e){ADN.Access.apply(this,arguments),this.id=e,this.endpoint=new ADN.Endpoint("posts/{0}"),this.createEndpoint=new ADN.Endpoint("posts")}e.prototype=Object.create(ADN.Access.prototype),e.prototype.deletePost=function(e,t,n){e=e||this.id,this.endpoint.addUrlParameter(e);var r={method:"DELETE",credentials:!0};this.sendRequest(r,function(e){e?t():n()},n)},e.prototype.postMessage=function(e,t,n){var r={headers:{"Content-Type":"application/x-www-form-urlencoded"},endpoint:this.createEndpoint,method:"POST",data:e,credentials:!1};this.sendRequest(r,t,n)},e.prototype.retrieve=function(e,t){this.endpoint.addUrlParameter(this.id),this.sendRequest(null,e,t)},e.sort=function(e,t){return(e||[]).sort(function(e,n){var r=Date.parse(e.created_at),i=Date.parse(n.created_at);return t(r,i)?1:-1})},e.sortAscending=function(e){return this.sort(e,function(e,t){return e>t})},e.sortDescending=function(e){return this.sort(e,function(e,t){return e<t})},Object.defineProperty(ADN,"Post",{value:e})}(),function(){"use strict";function e(e){ADN.Access.apply(this,arguments),this.postId=e,this.endpoint=new ADN.Endpoint("posts/{0}/replies")}e.prototype=Object.create(ADN.Access.prototype),e.prototype.retrieve=function(e,t){this.endpoint.addUrlParameter(this.postId),this.sendRequest(null,e,t)},Object.defineProperty(ADN,"Replies",{value:e})}();